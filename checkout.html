<script>
const products = {
  "focus-planner": {name: "Focus Planner PDF", price: 9},
  "notion-template": {name: "Notion Workspace Template", price: 19},
  "marketing-checklist": {name: "Marketing Checklist PDF", price: 12},
  "pro-bundle": {name: "Pro Bundle", price: 29}
};

// --------------------
// PUSH BEGIN_CHECKOUT ON PAGE LOAD
// --------------------
window.dataLayer = window.dataLayer || [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

if (cart.length > 0) {
  const items = cart.map(id => ({
    item_id: id,
    item_name: products[id].name,
    price: products[id].price,
    quantity: 1
  }));

  const total = items.reduce((sum, i) => sum + i.price, 0);

  dataLayer.push({
    event: 'begin_checkout',
    ecommerce: {
      currency: 'USD',
      value: total,
      items: items
    }
  });
}

// --------------------
// HANDLE FORM SUBMIT
// --------------------
document.getElementById('checkout-form').addEventListener('submit', function(e) {
  e.preventDefault();

  if (cart.length === 0) {
    alert('Cart is empty!');
    return;
  }

  // Save order data for Thank You page
  const items = cart.map(id => ({
    item_id: id,
    item_name: products[id].name,
    price: products[id].price,
    quantity: 1
  }));

  const total = items.reduce((sum, i) => sum + i.price, 0);

  const orderData = {
    transaction_id: 'T_' + Date.now(),
    currency: 'USD',
    value: total,
    items: items
  };

  sessionStorage.setItem('orderData', JSON.stringify(orderData));

  // Clear cart (demo)
  localStorage.removeItem('cart');

  // Redirect to Thank You page
  window.location.href = 'thankyou.html';
});
</script>
